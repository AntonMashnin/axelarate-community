---
id: join-as-validator-docker
sidebar_position: 3
sidebar_label: Подключение к сети Axelar в качестве валидатора с использованием докера
slug: /join-as-validator-docker
---
# Запуск валидатора в сети Axelar (с использованием Docker контейнера)
Присоединяйтесь и выходите из сети Axelar в качестве валидатора сети.

Преобразуйте существующий узел Axelar Network в валидатор, подключив узлы Биткойн и Эфириум и разместив токены. Валидатор участвует в создании блока, подписании транзакций и голосовании.

Задание можно выполнить с помощью установки на основе докера, а также с помощью установки из исходного кода. Важно, чтобы вы оставались последовательными, т.е. если Вы настраиваете узел с помощью установки из исходного кода, выполните задание, следуя инструкциям которая включает в себя шаги установки из исходного кода, а если Вы настраиваете узел с помощью докера, выполните это задания, следуя инструкциям для установки докера.

## Уровень
Продвинутый

## Отказ от ответственности
:::предупреждение Axelar Network находится в стадии разработки. Ни в коем случае нельзя передавать какие-либо реальные активы с помощью Axelar. Используйте только те токены тестовой сети, которые Вы не боитесь потерять. Axelar не несет ответственности за потерянные активы, или их заморозку или за токены которые не подлежат восстановлению в любом состоянии. Если Вы обнаружите проблему,пожалуйста, сообщите о ней используя данный репозиторий, следуя шаблону. 
:::

## Предварительные требования
- Выполните все шаги из этого руководства [Установка с помощью Docker(a)](https://github.com/axelarnetwork/axelarate-community/blob/main/documentation/docs/setup-with-docker.md) или [Установка из исходного кода](https://github.com/axelarnetwork/axelarate-community/blob/main/documentation/docs/setup-with-binaries.md)
- Пока сеть находится в разработке, зарегистрируйтесь и получите 'okay' от модератора тестовой сети или члена команды Axelar перед тем как начнёте выполнять настройку
- Убедитесь, что Вы выбрали правильный тег для репозитория axelarate-community, проверьте testnet-releases.md
- Минимальные аппаратные требования валидатора: 16 ядер, 16 ГБ ОЗУ, 1,5 ТБ диск. Рекомендуемые 32 ядра, 32 ГБ ОЗУ, 2 ТБ+ диск

## Полезные ссылки
- [Дополнительные команды для получения состояния сети Axelar](https://github.com/axelarnetwork/axelarate-community/blob/main/documentation/docs/extra-commands.md)

## Присоединитесь к тестовой сети Axelar
Следуйте инструкциям в README.md, чтобы убедиться, что Ваш узел обновлен и Вы получили несколько тестовых монет на свою учетную запись валидатора.

## Настройте узлы Биткойн и Эфириум
Как валидатор Axelar Network, ваш узел Axelar будет голосовать за статус транзакций Биткойн и Эфириум. Для этого Вы должны сначала установить и настроить узлы тестовой сети Биткойн и Эфириум, а затем предоставить конечные точки RPC для Axelar.

Если у Вас еще нет узла тестовой сети Биткойн и узла тестовой сети Ethereum Ropsten, Вы можете воспользоваться руководством [инструкция](https://github.com/axelarnetwork/axelarate-community/blob/main/documentation/Admin/eth-btc-node-setup.md) чтобы установить и настроить их, затем перейдите к следующему разделу `Connect Bitcoin and Ethereum nodes to Axelar`. Вы также можете настроить альтернативную конфигурацию на Ваш выбор.

Конфигурация узла Биткойн и Эфириум будет различаться для разных систем. Подробные инструкции по настройке для локальной машины, работающей на `macOS` `Bitcoin Core` и `Geth` можно найти [здесь](https://github.com/axelarnetwork/axelarate-community/blob/main/documentation/Admin/eth-btc-node-setup.md) и используется как ссылка.


### Настройка Bitcoin testnet ноды

1. Убедитесь, что Ваш узел тестовой сети Биткойн обновлен. Остановите узел, прежде чем вносить какие-либо изменения в конфигурацию.

2. Включите следующие настройки.

* Включите  `RPC Server`.
* Сгенерируйте `RPC Auth` значение, указав имя пользователя и пароль (не забудьте где-нибудь сохранить имя пользователя и пароль, они понадобятся Вам позже). Например `RPC Auth` значение
```bash
rpcauth=jacky:a8e51174a095fe52491f4f487d41053a$9336f388b175ef3a8a63b248446aa3ccd0c8644bbb85ab005d447e164b7e9712
```
* Установите `Разрешённый RPC IP адрес` как `0.0.0.0/0`.

3. Найдите конечную точку RPC вашего биткойн-узла, к которой Axelar подключится.

Конечная RPC точка Вашего узла тестовой сети Биткойн должна быть

```bash
http://{USERNAME}:{PASSWORD}@{IPADDRESS}:{PORT}
```

Если Ваш узел работает с использованием докер контейнера, используйте `host.docker.internal` в качестве `IPADDRESS` поскольку ядро Axelar будет работать в докер контейнере.
т.е)

```bash
http://jacky:mypassword@host.docker.internal:18332
```

Имя пользователя и пароль `username`/ `password` поля — это значения, которые Вы указали ранее для параметра `RPC Auth`. Запишите конечную точку Bitcoin RPC, так как она понадобится Вам позже.

4. НЕОБЯЗАТЕЛЬНО: проверьте свой биткойн-узел.

Чтобы проверить свои настройки, Вы можете отправить запрос RPC на свой биткойн-узел, используя cURL. Используйте следующее и замените конечную точку RPC.

```bash
curl -X POST http://jacky:mypassword@localhost:8332 \
-H "Content-Type: application/json" \
--data '{"jsonrpc":"2.0","method":"getblockchaininfo","params":[],"id":1}'
```


### Конфигурация узла тестовой сети Ethereum Ropsten

1. Убедитесь, что ваш узел тестовой сети Ropsten обновлен. Остановите узел, прежде чем вносить какие-либо изменения в конфигурацию.

2. Включите следующие настройки.

* Включите  `HTTP-RPC Server` для RPC взаимодействия.
* Установите  `HTTP-RPC virtual address` как `*`
* Установите `HTTP-RPC listening address` как `0.0.0.0`.

3. Найдите конечную точку RPC Вашего биткойн-узла, к которой Axelar подключится.

Конечная точка RPC Вашего узла тестовой сети Ethereum Ropsten должна быть

```bash
http://{IPADDRESS}:{PORT}
```

Если Ваш узел работает с использованием докера, используйте `host.docker.internal` в качестве `IPADDRESS`.
т.е)

```bash
http://host.docker.internal:8332
```

4. ДОПОЛНИТЕЛЬНО: протестируйте свой узел Ethereum.

Чтобы проверить конфигурацию, Вы можете отправить запрос RPC на свой узел Ethereum, используя cURL. Используйте следующее и замените конечную точку RPC.

```bash
curl -X POST http://localhost:8545 \
-H "Content-Type: application/json" \
--data '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}'
```


## Подключите узлы Биткойн и Эфириум к Axelar

1. Добейтесь, чтобы нода Axelar была полностью настроена и работала, выполнив шаги из файла README.md. Убедитесь, что у Вас есть несколько монет тестовой сети на Вашем адресе валидатора.

2. Остановите узел Axelar. Откройте новый терминал и запустите

```bash
docker stop $(docker ps -a -q)
```

3. Перейдите в свой домашний каталог и откройте `~/axelarate-community/join/config.toml`.

4. Прокрутите файл до конца и найдите  `##### bitcoin bridge options #####` и `##### EVM bridges options #####`.

5. Найдите `rpc_addr` строку и замените URL-адрес RPC по умолчанию на URL-адрес Вашего узла как для биткойнов, так и для Ethereum. Сохраните файл. Этот URL-адрес RPC был найден и записан в разделе настройки узла Биткойн и Эфириум.

6. Запустите узел Axelar, чтобы изменения вступили в силу. Запустите скрипт  `join/join-testnet.sh` снова с теми же параметрами, что и раньше `--axelar-core`, `--tofnd` (и по желанию `--root`). НЕ используйте `--reset-chain` флаг или Вашему узлу придется снова синхронизироваться с самого начала.


## Присоединение к сети в качестве валидатора

Здесь мы предполагаем, что у Вас есть узел, работающий с использованием `join/join-testnet.sh` скрипта.

1. Откройте командную строку Axelar узла
```bash
docker exec -it axelar-core sh
```

2. Загрузите средства на свой счет `валидатора`, который Вы будете использовать позже.

Найдите адрес с помощью команды

```bash
axelard keys show validator -a
```

Перейдите [Axelar faucet](http://faucet.testnet.axelar.dev/) и получите монеты на свой адрес валидатора.

Убедитесь, что Вы получили средства

```bash
axelard q bank balances {validator address}
```

т.е)

```bash
axelard q bank balances axelar1p5nl00z6h5fuzyzfylhf8w7g3qj6lmlyryqmhg
```

3. Сделайте свою учетную запись `валидатора` валидатором, застейкав несколько монет.

Используйте следующую команду, но измените `сумму` на любой имеющийся у Вас баланс. Помните, что это на самом деле деноминировано в `uaxl`. Также измените `moniker` чтобы задать псевдонимом для Вашего валидатора.

```bash
axelard tx staking create-validator --yes \
--amount "1000000uaxl" \
--moniker "testvalidator1" \
--commission-rate="0.10" \
--commission-max-rate="0.20" \
--commission-max-change-rate="0.01" \
--min-self-delegation="1" \
--pubkey "$(axelard tendermint show-validator)" \
--from validator \
-b block
```

Чтобы проверить, сколько монет Ваш валидатор в настоящее время застейкал, запустите.
```bash
axelard q staking validator "$(axelard keys show validator --bech val -a)" | grep tokens
```

Если Вы хотите внести больше монет после первоначального создания валидатора.
```bash
axelard tx staking delegate {axelarvaloper address} {amount} --from validator -y
```

т.е)

```bash
axelard tx staking delegate "$(axelard keys show validator --bech val -a)" "100000000uaxl" --from validator -y
```

4. Зарегистрируйте учетную запись broadcaster в качестве прокси для Вашего валидатора.  Сеть Axelar распространяет сообщения от пороговых протоколов многосторонних вычислений через базовый консенсус. Сообщения подписываются и доставляются через блокчейн.

Откройте новый терминал и запустите ./join/launch-validator.sh скрипт используя те же параметры, что и раньше. НЕ используйте --reset-chain флаг или вашему узлу придется снова синхронизироваться с самого начала. Вывод должен быть примерно таким.

```bash
Tofnd & Vald running.

Proxy address: axelar1xg93jnefgz3gsnuyqrmq2q288z8st3cf43jecs

Чтобы стать валидатором, возьмите несколько токенов uaxl из крана и застейкайте их.


- name: broadcaster
  type: local
  address: axelar1xg93jnefgz3gsnuyqrmq2q288z8st3cf43jecs
  pubkey: axelarpub1addwnpepqg648uzk668g0e93y9sekaufgdp96fksjugk6e6c3eddypzc8qm525yhx2m
  mnemonic: ""
  threshold: 0
  pubkeys: []


**Важно** запишите эту мнемоник фразу в надежном месте.
Это единственный способ восстановить Вашу учетную запись, если Вы когда-нибудь забудете свой пароль.

admit come proud swear view stomach industry elephant extend bracket reveal dinner july absorb beef stick say pact sick
Не забудьте также сделать резервную копию мнемоник фразы tofnd (/Users/talalashraf/.tofnd/export)

Чтобы следить за выполнением tofnd, запустите 'docker logs -f tofnd'
Чтобы следить за выполнением vald, запустите 'docker logs -f vald'
Для остановки tofnd, запустите 'docker stop tofnd'
Для остановки vald, запустите 'docker stop vald'
```

Затем перейдите на страницу [Axelar крана](http://faucet.testnet.axelar.dev/) и получи монеты на свой `broadcaster` адрес.

Перейдите в командную строку узла Axelar:
```bash
docker exec -it axelar-core sh
```
Убедитесь, что Вы получили средства:
```bash
axelard q bank balances {broadcaster address}
```
т.е)

```bash
axelard q bank balances axelar1xg93jnefgz3gsnuyqrmq2q288z8st3cf43jecs
```

Используйте указанный Выше прокси-адрес, чтобы зарегистрировать учетную запись broadcaster в качестве прокси для Вашего валидатора.

```bash
axelard tx snapshot register-proxy [proxy address] [flags]
```

т.е)

```bash
axelard tx snapshot register-proxy axelar1xg93jnefgz3gsnuyqrmq2q288z8st3cf43jecs --from validator -y
```

5. Убедитесь, что Ваш узел `vald` и `tofnd` подключены правильно. В качестве валидатора Вы `axelar-core` свяжитесь с `tofnd` через `vald`. Это важно, когда в сети происходят такие события, как ротация ключей.

Во-первых, убедитесь, что контейнер vald запущен. Запустите следующие команды в новом окне терминала.

```bash
docker ps
```

Найдите контейнер с именем `vald`.

Теперь выполните команду в контейнере vald и убедитесь, что он может взаимодействовать с tofnd.

```bash
docker exec -ti vald sh
```

Внутри контейнера запустите
```bash
axelard tofnd-ping --tofnd-host tofnd
```

Если вы видите ответ вроде `PONG!` , это значит что `vald` контейнер успешно запущен и подключен к `tofnd`.


6. Найдите минимальное количество монет, которое Вам нужно застейкать.

Чтобы стать полноценным валидатором, который участвует в пороговых многосторонних подписях, Ваш валидатор должен делать ставки не менее 2% или 1/50 от общего стейкинг пула.

Зайдите на дискорд-сервер Axelar и найдите канал `testnet`. Откройте `pinned` сообщения в правом верхнем углу и прокрутите вниз до самого первого закрепленного сообщения, который содержит много ссылок. Найдите ссылку `Мониторинг` а также учетные данные пользователя тестовой сети и используйте ее для входа.

После того, как Вы вошли в панель мониторинга, найдите запись под названием `Bonded токены`. Это общий пул застейканных токенов в сети, деноминированный в `axl`. Однако позже, когда вы используете CLI, он фактически принимает номиналы в микро `axl` (`uaxl`) где 1 `axl` = 1,000,000 `uaxl`.

Итак, чтобы найти минимальное количество монет, которое Вам нужно застейкать на следующем шаге, рассчитайте `{total pool} * 1000000 / 50`.

т.е)
Если на панели инструментов отображается `3k` `Bonded токенов`, минимальная сумма `3000 * 1000000 / 50 = 60000000`.

:предупреждение: **Важно**: ключевые доли для подписания транзакций в других цепочках распределяются пропорционально долям валидаторов на Axelar. Чтобы пока сохранить количество ключевых акций на низком уровне,, пожалуйста, делегируйте ту же сумму стейка, что и у существующих валидаторов, т.е. `100000000uaxl`.

7. Попросите команду Axelar в канале тестовой сети, чтобы запросить дополнительные токены. Кран не сможет дать Вам необходимое количество токенов, поэтому команда вручную отправит их на Ваш адрес. Команда захочет убедиться, что Ваш валидатор настроен правильно, и отправит дополнительные средства на Ваш кошелек. Как только Вы получите подтверждение от команды о том, что у Вас есть дополнительные средства для ставки, убедитесь, что они находятся в Вашем кошельке, и сделайте ставку.

```bash
axelard tx staking delegate {axelarvaloper address} {amount} --from validator -y
```

т.е)

```bash
axelard tx staking delegate "$(axelard keys show validator --bech val -a)" "100000000uaxl" --from validator -y
```
### **Важно: Контрольный список после установки**

Проверьте это:

1. Все три контейнера запущены (`axelar-core`, `vald`, and `tofnd`).
2. Вы можете проверить доступность (смтори `tofnd-ping` выше) `tofnd` от `vald` контейнера.
3. Ваши внешние узлы (Биткойн, Эфириум и т. д.) работают и правильно отображают конечные точки.
4. Вы сделали резервную копию своих мнемоник фраз [руководство](https://github.com/axelarnetwork/axelarate-community/blob/main/documentation/Admin/validator-backup.md)
5. После того, как команда предоставит Вам достаточную долю и подтвердит, что ротация завершена, Вы можете изучить различные доли, которые у Вас есть, после [здесь](https://github.com/axelarnetwork/axelarate-community/blob/main/documentation/Admin/validator-extra-commands.md).
6. Напоминание о том, что Вам нужно как минимум `1 axl` участвовать в консенсусе и, по крайней мере, `2\%` от общей суммы залогового пакета для участия в пороговом MPC.
7. Проверьте, есть ли у Вас некоторые `uaxl` на Вашем `broadcaster` адрес. Используйте [Axelar кран](http://faucet.testnet.axelar.dev/) чтобы получить несколько монет, если он не финансируется.
8. После этого Вы становитесь активным валидатором и должны тщательно охранять свою ноду и все ключи.

### Устранение неполадок при запуске

Если процесс отсутствует, проверьте, запущен ли `tofnd`. Установите `nmap` утилиту, если у Вас ее нет, и проверьте порт tofnd

```bash
nmap -p 50051 localhost
```

Ищите `STATE` порта, который должен быть `открыт` или `закрыт`. Если порт `закрыт`, перезапустите узел и убедитесь, что tofnd запущен. Если порт `открыт`, тогда возникает проблема с соединением между vald и tofnd.

Чтобы решить проблему с подключением, найдите адрес контейнера `tofnd` вручную и сообщите его `vald`.
Найдите адрес `tofnd`.

```bash
docker inspect tofnd
```

В нижней части вывода JSON найдите `Сети`, затем `мост`, `IP-адрес` и скопируйте указанный адрес.
Затем пропингуйте IP-адрес изнутри `Axelar Core`, чтобы проверить, работает ли он. Установите утилиту `ping`, если она отсутсвует.

```bash
docker exec axelar-core ping {Ваш tofnd IP адрес}
```

т.е)

```bash
docker exec axelar-core ping 172.17.0.2
```

Вы должны увидеть, что записи начинают появляться одна за другой, если соединение установлено успешно. Остановить пинг с помощью `Control + C`.
Сохраните этот IP адрес.

Затем запросите свой адрес валидатора с помощью

```bash
docker exec axelar-core axelard keys show validator --bech val -a
```
:::Внимание
Убедитесь, что возвращаемый адрес валидатора начинается с `axelarvaloper`.
:::

Теперь запустите `vald`, указав IP-адрес и адрес валидатора:

```bash
docker exec axelar-core axelard vald-start --tofnd-host {your tofnd IP Address} --validator-addr {your validator address} --node {your axelar-core IP address}
```
т.е)
```bash
docker exec axelar-core axelard vald-start --tofnd-host 172.17.0.2 --validator-addr axelarvaloper1y4vplrpdaqplje8q4p4j32t3cqqmea9830umwl
```



Ваш vald должен быть правильно подключен. Подтвердите это, выполнив следующее и найдя запись `vald-start`.
```bash
docker exec axelar-core ps
```


Ваш узел теперь является валидатором! Оставайтесь валидатором и поддерживайте работу своего узла хотя бы день. Если Вы хотите перестать быть валидатором, следуйте инструкциям в следующем разделе.


## Выход из сети в качестве валидатора

1. Деактивируйте свою учетную запись broadcast.
```bash
axelard tx snapshot deactivate-proxy --from validator -y -b block
```

2. Дождитесь следующего поворота ключа, чтобы изменения вступили в силу. В этом выпуске мы запускаем ротацию ключей примерно раз в день. Так что возвращайтесь через 24 часа и переходите к следующему шагу. Если Вы по-прежнему получаете сообщение об ошибке через 24 часа, обратитесь к члену команды.

3. Отпустите застейканные монеты.
```bash
axelard tx staking unbond {axelarvaloper address} {amount} --from validator -y -b block
```

т.е)

```bash
axelard tx staking unbond "$(axelard keys show validator --bech val -a)" "100000000uaxl" --from validator -y -b block
```

`amount` относится к тому, сколько монет Вы хотите снять со ставки. Вы можете изменить сумму.

Чтобы сохранить стабильность сети, застейканые монеты удерживаются примерно в течение 1 дня, начиная с запроса на отмену привязки, прежде чем они будут разблокированы и возвращены на учетную запись `Валидатора`.
